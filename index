```html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador Dorado 360</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    screens: {
                        'print': {'raw': 'print'},
                    }
                }
            }
        }
    </script>
    <style>
        @media print {
            @page { size: A4; margin: 0; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
        /* Estilo para ocultar elementos suavemente */
        .hidden-section { display: none; }
    </style>
</head>
<body class="min-h-screen bg-slate-50 font-sans text-slate-900 pb-20 print:bg-white print:pb-0">

    <header class="bg-white text-slate-900 p-4 sticky top-0 z-50 shadow-lg print:hidden">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-yellow-600 rounded-full flex items-center justify-center">
                    <i data-lucide="home" class="text-white w-4 h-4"></i>
                </div>
                <h1 class="text-lg font-bold tracking-wide text-yellow-600">DORADO <span class="text-yellow-600">360</span></h1>
            </div>
            <button id="btn-print-header" disabled class="bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-md">
                <i data-lucide="printer" class="w-4 h-4"></i>
                <span class="hidden sm:inline">Exportar PDF</span>
            </button>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 sm:p-6 print:hidden">
        
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 mb-4 overflow-hidden">
            <button onclick="toggleSection('sec-info')" class="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 transition-colors">
                <div class="flex items-center gap-3 text-slate-800 font-semibold">
                    <i data-lucide="user" class="text-yellow-600 w-5 h-5"></i>
                    <span>Información General</span>
                </div>
                <i data-lucide="chevron-down" class="text-gray-400 w-5 h-5"></i>
            </button>
            <div id="sec-info" class="p-5 border-t border-gray-100">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="mb-3">
                        <label class="block text-xs font-medium text-gray-500 mb-1 uppercase tracking-wider">Asesor</label>
                        <div class="relative">
                            <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"><i data-lucide="user" class="w-3 h-3"></i></div>
                            <input type="text" id="input-asesor" class="w-full rounded-lg border bg-white border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 py-2.5 pl-10 pr-3 transition-all text-sm sm:text-base shadow-sm">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="block text-xs font-medium text-gray-500 mb-1 uppercase tracking-wider">Cliente</label>
                        <div class="relative">
                            <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"><i data-lucide="user" class="w-3 h-3"></i></div>
                            <input type="text" id="input-cliente" class="w-full rounded-lg border bg-white border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 py-2.5 pl-10 pr-3 transition-all text-sm sm:text-base shadow-sm">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="block text-xs font-medium text-gray-500 mb-1 uppercase tracking-wider">Fecha Cotización</label>
                        <div class="relative">
                            <input type="date" id="input-fecha" class="w-full rounded-lg border bg-white border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 py-2.5 pl-3 pr-3 transition-all text-sm sm:text-base shadow-sm">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-100 mb-4 overflow-hidden">
            <button onclick="toggleSection('sec-unidad')" class="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 transition-colors">
                <div class="flex items-center gap-3 text-slate-800 font-semibold">
                    <i data-lucide="home" class="text-yellow-600 w-5 h-5"></i>
                    <span>Selección de Unidad</span>
                </div>
                <i data-lucide="chevron-down" class="text-gray-400 w-5 h-5"></i>
            </button>
            <div id="sec-unidad" class="p-5 border-t border-gray-100">
                <div class="mb-4">
                    <label class="block text-xs font-medium text-gray-500 mb-1 uppercase">Unidades Disponibles</label>
                    <select id="select-unidad" class="w-full p-3 bg-white border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 text-base">
                        <option value="" disabled selected>Selecciona un departamento...</option>
                        </select>
                </div>
            </div>
        </div>

        <div id="dynamic-content" class="hidden-section">
            
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 mb-4 overflow-hidden">
                <button onclick="toggleSection('sec-politica')" class="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 transition-colors">
                    <div class="flex items-center gap-3 text-slate-800 font-semibold">
                        <i data-lucide="clock" class="text-yellow-600 w-5 h-5"></i>
                        <span>Política Comercial y Tiempos</span>
                    </div>
                    <i data-lucide="chevron-down" class="text-gray-400 w-5 h-5"></i>
                </button>
                <div id="sec-politica" class="p-5 border-t border-gray-100">
                    
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100 mb-6">
                        <p class="text-sm font-medium text-yellow-800 mb-2">Descuento Especial</p>
                        <div class="flex gap-3">
                            <div class="flex-1">
                                <label class="block text-xs font-medium text-gray-500 mb-1 uppercase tracking-wider">Porcentaje (%)</label>
                                <div class="relative">
                                    <input type="number" id="input-desc-pct" value="0" class="w-full rounded-lg border bg-white border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 py-2.5 pl-3 pr-10 text-sm shadow-sm">
                                    <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">%</div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <label class="block text-xs font-medium text-gray-500 mb-1 uppercase tracking-wider">Monto ($)</label>
                                <div class="relative">
                                    <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">$</div>
                                    <input type="number" id="input-desc-monto" value="0" class="w-full rounded-lg border bg-white border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 py-2.5 pl-10 pr-3 text-sm shadow-sm">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1 uppercase tracking-wider">Apartado ($)</label>
                            <div class="relative">
                                <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">$</div>
                                <input type="number" id="input-apartado" value="50000" class="w-full rounded-lg border bg-white border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 py-2.5 pl-10 pr-3 text-sm shadow-sm">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1 uppercase tracking-wider">Inicio Mensualidad</label>
                            <input type="date" id="input-inicio-mensualidad" class="w-full rounded-lg border bg-white border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 py-2.5 pl-3 pr-3 text-sm shadow-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1 uppercase tracking-wider">Diferimiento (Meses)</label>
                            <div class="relative">
                                <input type="number" id="input-diferimiento" min="0" step="1" value="0" class="w-full rounded-lg border bg-white border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 py-2.5 pl-3 pr-10 text-sm shadow-sm">
                                <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">Meses</div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1 uppercase">Diferir Enganche</label>
                            <select id="select-diferir-enganche" class="w-full p-2.5 bg-white border border-gray-300 rounded-lg text-sm h-[42px]">
                                <option value="1">1 Pago (Inmediato)</option>
                                <option value="2">2 Meses</option>
                                <option value="3">3 Meses</option>
                            </select>
                        </div>
                    </div>

                    <div id="msg-diferimiento" class="mt-2 p-2 bg-blue-50 text-blue-700 text-sm rounded flex items-center gap-2 hidden-section">
                        <i data-lucide="calendar" class="w-4 h-4"></i>
                        <span>Inicio real de pagos: <strong id="txt-inicio-real"></strong> (Diferido <span id="txt-meses-dif"></span> meses)</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-100 mb-4 overflow-hidden">
                <button onclick="toggleSection('sec-esquema')" class="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 transition-colors">
                    <div class="flex items-center gap-3 text-slate-800 font-semibold">
                        <i data-lucide="calculator" class="text-yellow-600 w-5 h-5"></i>
                        <span>Esquema de Pago</span>
                    </div>
                    <i data-lucide="chevron-down" class="text-gray-400 w-5 h-5"></i>
                </button>
                <div id="sec-esquema" class="p-5 border-t border-gray-100 space-y-6">
                    
                    <div>
                        <div class="flex justify-between mb-1"><label class="font-bold text-slate-700">1. Enganche (<span id="lbl-enganche-pct">30.0</span>%)</label></div>
                        <input type="range" id="range-enganche" min="1" max="100" step="0.5" value="30" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600 mb-2">
                        <div class="flex gap-4">
                            <div class="w-24">
                                <div class="relative">
                                    <input type="number" id="input-enganche-pct" value="30" class="w-full rounded-lg border bg-white border-gray-300 py-2.5 pl-3 pr-8 text-sm shadow-sm">
                                    <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">%</div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="relative">
                                    <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">$</div>
                                    <input type="number" id="input-enganche-monto" class="w-full rounded-lg border bg-white border-gray-300 py-2.5 pl-8 pr-3 text-sm shadow-sm">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="flex justify-between mb-1"><label class="font-bold text-slate-700">2. Financiado (<span id="lbl-financiado-pct">50.0</span>%)</label></div>
                        <input type="range" id="range-financiado" min="0" max="100" step="0.5" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-yellow-500 mb-2">
                        <div class="flex gap-4">
                            <div class="w-24">
                                <div class="relative">
                                    <input type="number" id="input-financiado-pct" value="50" class="w-full rounded-lg border bg-white border-gray-300 py-2.5 pl-3 pr-8 text-sm shadow-sm">
                                    <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">%</div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="relative">
                                    <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">$</div>
                                    <input type="number" id="input-financiado-monto" class="w-full rounded-lg border bg-white border-gray-300 py-2.5 pl-8 pr-3 text-sm shadow-sm">
                                </div>
                            </div>
                        </div>
                        <div id="plazos-container" class="mt-2 flex flex-wrap gap-2">
                            </div>
                    </div>

                    <div>
                        <div class="flex justify-between mb-1"><label class="font-bold text-slate-700">3. Contra Entrega (<span id="lbl-contra-pct">20.0</span>%)</label></div>
                        <input type="range" id="range-contra" min="0" max="100" step="0.5" value="20" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-600 mb-2">
                        <div class="flex gap-4">
                            <div class="w-24">
                                <div class="relative">
                                    <input type="number" id="input-contra-pct" value="20" class="w-full rounded-lg border bg-white border-gray-300 py-2.5 pl-3 pr-8 text-sm shadow-sm">
                                    <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">%</div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="relative">
                                    <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">$</div>
                                    <input type="number" id="input-contra-monto" class="w-full rounded-lg border bg-white border-gray-300 py-2.5 pl-8 pr-3 text-sm shadow-sm">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="error-suma" class="text-red-600 text-xs font-bold hidden-section">
                        ⚠️ Suma total: <span id="lbl-suma-total">0</span>% (Debe ser 100%)
                    </div>

                </div>
            </div>

        </div>
    </main>

    <div id="sticky-footer" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 pb-6 z-40 print:hidden shadow-[0_-5px_20px_rgba(0,0,0,0.1)] hidden-section">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
           <div>
             <p class="text-xs text-gray-500 uppercase font-bold">Mensualidad Estimada</p>
             <p id="txt-mensualidad-footer" class="text-xl font-bold text-yellow-600">$0.00</p>
           </div>
           <button onclick="window.print()" class="bg-slate-900 text-white px-6 py-3 rounded-xl font-bold shadow-lg flex items-center gap-2 hover:bg-slate-800 transition-all">
             <i data-lucide="file-text" class="w-5 h-5"></i>
             <span class="hidden sm:inline">Ver PDF</span>
             <span class="sm:hidden">PDF</span>
           </button>
        </div>
     </div>

    <div id="print-layout" class="hidden print:flex flex-col bg-white w-[210mm] h-[297mm] mx-auto p-[12mm] relative box-border font-serif text-slate-900">
        
        <div class="absolute inset-0 flex items-center justify-center opacity-[0.03] pointer-events-none z-0">
           <i data-lucide="home" width="400" height="400"></i>
        </div>

        <div class="relative z-10 h-full flex flex-col justify-between">
            
            <div class="flex justify-between items-start border-b-2 border-[#B8860B] pb-4 mb-6">
               <div class="flex items-center gap-4">
                   <div class="w-14 h-14 bg-[#B8860B] rounded-md flex items-center justify-center text-white shadow-sm">
                      <i data-lucide="home" class="w-8 h-8" stroke-width="1.5"></i>
                   </div>
                   <div>
                      <h1 class="text-3xl font-bold text-[#1a237e] tracking-tight leading-none font-sans">DORADO 360</h1>
                      <p class="text-xs text-[#B8860B] uppercase tracking-[0.2em] font-medium mt-1">Luxury Living</p>
                   </div>
               </div>
               <div class="text-right">
                   <h2 class="text-xl font-bold text-slate-800 mb-1">COTIZACIÓN</h2>
                   <p class="text-sm text-gray-500 font-sans">Folio: <span id="print-folio">0000</span></p>
                   <p id="print-fecha" class="text-sm text-gray-800 font-medium mt-1">Fecha</p>
               </div>
            </div>

            <div class="grid grid-cols-12 gap-6 mb-6">
                <div class="col-span-5 bg-slate-50 p-4 rounded-sm border-l-4 border-[#1a237e]">
                    <h3 class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-3 font-sans">Información del Cliente</h3>
                    <div class="space-y-2">
                        <div>
                            <span class="block text-[9px] text-gray-500 uppercase">Cliente</span>
                            <p id="print-cliente" class="font-bold text-slate-900 text-sm border-b border-gray-200 pb-1">Por definir</p>
                        </div>
                        <div>
                            <span class="block text-[9px] text-gray-500 uppercase">Asesor Comercial</span>
                            <p id="print-asesor" class="font-bold text-slate-900 text-sm border-b border-gray-200 pb-1">Por asignar</p>
                        </div>
                    </div>
                </div>

                <div class="col-span-7">
                     <h3 class="text-[10px] font-bold text-[#B8860B] uppercase tracking-wider mb-3 font-sans border-b border-gray-100 pb-1">Detalles de Propiedad</h3>
                     <div class="grid grid-cols-2 gap-y-4 gap-x-6 font-sans">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-yellow-50 rounded text-[#B8860B]"><i data-lucide="home" class="w-4 h-4"></i></div>
                            <div>
                                <span class="block text-[9px] text-gray-500 uppercase">Unidad</span>
                                <span id="print-unidad" class="font-bold text-lg text-[#1a237e]">---</span>
                            </div>
                        </div>
                         <div class="flex items-center gap-3">
                            <div class="p-2 bg-yellow-50 rounded text-[#B8860B]"><i data-lucide="map-pin" class="w-4 h-4"></i></div>
                            <div>
                                <span class="block text-[9px] text-gray-500 uppercase">Nivel</span>
                                <span id="print-nivel" class="font-bold text-sm text-gray-800">---</span>
                            </div>
                        </div>
                         <div class="flex items-center gap-3">
                            <div class="p-2 bg-yellow-50 rounded text-[#B8860B]"><i data-lucide="check-circle" class="w-4 h-4"></i></div>
                            <div>
                                <span class="block text-[9px] text-gray-500 uppercase">Tipología</span>
                                <span id="print-tipologia" class="font-bold text-sm text-gray-800">---</span>
                            </div>
                        </div>
                         <div class="flex items-center gap-3">
                            <div class="p-2 bg-yellow-50 rounded text-[#B8860B]"><i data-lucide="dollar-sign" class="w-4 h-4"></i></div>
                            <div>
                                <span class="block text-[9px] text-gray-500 uppercase">Precio Lista</span>
                                <span id="print-precio-lista" class="font-bold text-sm text-gray-800">$0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <div class="flex items-center gap-2 mb-2 border-b border-gray-200 pb-1">
                    <span class="bg-[#1a237e] w-1 h-4 rounded-sm"></span>
                    <h3 class="text-sm font-bold text-[#1a237e] uppercase tracking-wide font-sans">Resumen Financiero</h3>
                </div>
                
                <table class="w-full text-xs font-sans">
                    <thead class="bg-[#f8f9fa] text-gray-600 font-bold border-y border-gray-200">
                        <tr>
                            <th class="py-2 px-3 text-left w-1/3">Concepto</th>
                            <th class="py-2 px-3 text-center">Porcentaje</th>
                            <th class="py-2 px-3 text-right">Monto</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100 text-gray-700">
                         <tr id="row-descuento" class="text-red-600 bg-red-50 hidden-section">
                             <td class="py-2 px-3 font-medium">Descuento Aplicado</td>
                             <td id="print-desc-pct" class="py-2 px-3 text-center">0%</td>
                             <td id="print-desc-monto" class="py-2 px-3 text-right">- $0.00</td>
                         </tr>
                         <tr class="bg-[#1a237e] text-white font-bold">
                             <td class="py-2 px-3">PRECIO NETO FINAL</td>
                             <td class="py-2 px-3 text-center">100%</td>
                             <td id="print-precio-final" class="py-2 px-3 text-right">$0.00</td>
                         </tr>
                    </tbody>
                </table>
            </div>

            <div class="mb-4 flex-grow">
                 <div class="flex items-center gap-2 mb-2 border-b border-gray-200 pb-1">
                    <span class="bg-[#B8860B] w-1 h-4 rounded-sm"></span>
                    <h3 class="text-sm font-bold text-[#B8860B] uppercase tracking-wide font-sans">Esquema de Pagos</h3>
                </div>

                <table class="w-full text-[11px] font-sans mb-4">
                    <tbody class="divide-y divide-gray-100">
                         <tr>
                             <td class="py-2 font-bold text-gray-700 w-1/3">1. Pago Inicial (Apartado)</td>
                             <td class="py-2 text-center text-gray-400">—</td>
                             <td id="print-apartado" class="py-2 text-right font-bold text-gray-900">$0.00</td>
                         </tr>
                         <tr>
                             <td class="py-2">
                                <span class="font-bold text-gray-700">2. Enganche Complementario</span>
                                <span id="print-diferir-txt" class="block text-[9px] text-blue-600 italic pl-3 hidden-section"></span>
                             </td>
                             <td id="print-enganche-pct" class="py-2 text-center font-medium">0%</td>
                             <td id="print-enganche-monto" class="py-2 text-right font-medium">$0.00</td>
                         </tr>
                         <tr class="bg-yellow-50">
                             <td class="py-2 pl-2">
                                <span class="font-bold text-[#B8860B]">3. Financiado (<span id="print-plazo-meses">12</span> Meses)</span>
                                <span id="print-inicio-financiado" class="block text-[9px] text-gray-500 pl-3">
                                    Inicio: ---
                                </span>
                             </td>
                             <td id="print-financiado-pct" class="py-2 text-center font-bold text-[#B8860B]">0%</td>
                             <td id="print-financiado-monto" class="py-2 text-right font-bold text-[#B8860B] pr-2">$0.00</td>
                         </tr>
                         <tr>
                             <td class="py-2 font-bold text-gray-700">4. Contra Entrega</td>
                             <td id="print-contra-pct" class="py-2 text-center font-medium">0%</td>
                             <td id="print-contra-monto" class="py-2 text-right font-medium">$0.00</td>
                         </tr>
                    </tbody>
                </table>

                <div class="border border-gray-200 rounded-sm p-3 bg-white">
                    <h4 class="text-[10px] font-bold text-gray-400 uppercase mb-2 text-center tracking-widest">Calendario de Pagos (Vista Preliminar)</h4>
                    <div class="grid grid-cols-6 gap-2 text-[9px] text-center font-sans font-medium text-gray-600 border-b border-gray-100 pb-1 mb-1">
                        <div>No.</div>
                        <div class="col-span-2">Fecha</div>
                        <div class="col-span-2 text-right">Monto</div>
                        <div class="text-right">Saldo</div>
                    </div>
                    <div id="amortizacion-rows">
                        </div>
                    <div class="text-center mt-2">
                         <span class="inline-block bg-gray-100 text-gray-500 text-[8px] px-2 py-0.5 rounded-full">Tabla completa disponible bajo solicitud formal</span>
                    </div>
                </div>
            </div>

            <div class="mt-auto">
                <div class="flex justify-between items-end text-[10px] font-sans text-gray-500 mb-2">
                    <div>
                        <p>Generado por Sistema Dorado 360</p>
                    </div>
                    <div class="text-right">
                         <p>Página 1 de 1</p>
                    </div>
                </div>
                <div class="border-t border-gray-300 pt-3 text-center">
                     <p class="text-[9px] text-gray-400 leading-tight max-w-3xl mx-auto">
                        Este cotizador tiene una validez de dos días naturales a partir de la fecha de emisión. Precios disponibles sujetos a cambio sin previo aviso. Las imágenes y renders son ilustrativos. Los acabados finales pueden variar según disponibilidad.
                     </p>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- DATA ---
        const INVENTARIO = [
            { id: '101', unidad: '101', recamaras: 1, area: 47.63, precio: 2145000, estado: 'Disponible', nivel: 1, acabados: 'Lujo / Mármol' },
            { id: '102', unidad: '102', recamaras: 1, area: 47.63, precio: 0, estado: 'Vendido', nivel: 1 },
            { id: '201', unidad: '201', recamaras: 2, area: 62.49, precio: 3054804, estado: 'Disponible', nivel: 2, acabados: 'Lujo / Granito' },
            { id: '202', unidad: '202', recamaras: 1, area: 42.17, precio: 0, estado: 'Vendido', nivel: 2 },
            { id: '203', unidad: '203', recamaras: 2, area: 65.12, precio: 3192281, estado: 'Disponible', nivel: 2, acabados: 'Lujo / Granito' },
            { id: '301', unidad: '301', recamaras: 2, area: 62.49, precio: 3063833, estado: 'Disponible', nivel: 3, acabados: 'Lujo / Granito' },
            { id: '302', unidad: '302', recamaras: 1, area: 42.17, precio: 2138532, estado: 'Disponible', nivel: 3, acabados: 'Lujo / Mármol' },
            { id: '303', unidad: '303', recamaras: 2, area: 65.12, precio: 3201716, estado: 'Disponible', nivel: 3, acabados: 'Lujo / Granito' },
            { id: '401', unidad: '401', recamaras: 2, area: 62.49, precio: 0, estado: 'Vendido', nivel: 4 },
            { id: '402', unidad: '402', recamaras: 1, area: 42.17, precio: 2138532, estado: 'Disponible', nivel: 4, acabados: 'Lujo / Mármol' },
            { id: '403', unidad: '403', recamaras: 2, area: 65.12, precio: 3214297, estado: 'Disponible', nivel: 4, acabados: 'Lujo / Granito' },
            { id: '501', unidad: '501', recamaras: 2, area: 62.49, precio: 0, estado: 'Vendido', nivel: 5 },
            { id: '502', unidad: '502', recamaras: 1, area: 42.17, precio: 0, estado: 'Vendido', nivel: 5 },
            { id: '503', unidad: '503', recamaras: 2, area: 65.12, precio: 0, estado: 'Vendido', nivel: 5 },
            { id: 'E1', unidad: 'E1', recamaras: 0, area: 14.00, precio: 150000, estado: 'Disponible', nivel: 0, tipo: 'Estacionamiento' },
            { id: 'E2', unidad: 'E2', recamaras: 0, area: 14.00, precio: 0, estado: 'Vendido', nivel: 0, tipo: 'Estacionamiento' },
            { id: 'E3', unidad: 'E3', recamaras: 0, area: 14.00, precio: 0, estado: 'Vendido', nivel: 0, tipo: 'Estacionamiento' },
        ];

        const PLAZOS = [3, 6, 9, 12, 15, 18];

        // --- STATE ---
        let STATE = {
            fecha: new Date().toISOString().split('T')[0],
            asesor: '',
            cliente: '',
            unidadSeleccionada: null,
            precioBase: 0,
            descuentoMonto: 0,
            descuentoPorcentaje: 0,
            enganchePorcentaje: 30,
            engancheMonto: 0,
            financiadoPorcentaje: 50,
            financiadoMonto: 0,
            contraEntregaPorcentaje: 20,
            contraEntregaMonto: 0,
            plazoMeses: 12,
            apartado: 50000,
            diferirEnganche: 1,
            fechaInicioMensualidad: new Date().toISOString().split('T')[0],
            mesesDiferido: 0,
            precioFinal: 0
        };

        // --- UTILS ---
        const formatMoney = (amount) => new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN', minimumFractionDigits: 2 }).format(amount);

        const createUTCDate = (dateString) => {
            const [year, month, day] = dateString.split('-').map(Number);
            return new Date(Date.UTC(year, month - 1, day, 12, 0, 0));
        };

        const formatDate = (dateString) => {
            if (!dateString) return 'No definida';
            const date = createUTCDate(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' };
            return date.toLocaleDateString('es-MX', options);
        };

        const addMonths = (dateString, months) => {
            if (!dateString) return null;
            const date = createUTCDate(dateString);
            date.setUTCMonth(date.getUTCMonth() + parseInt(months));
            return date.toISOString().split('T')[0];
        };

        // --- LOGIC ---

        function init() {
            // Populate Unit Select
            const select = document.getElementById('select-unidad');
            INVENTARIO.forEach(u => {
                const option = document.createElement('option');
                option.value = u.id;
                option.disabled = u.estado !== 'Disponible';
                option.text = `${u.unidad} - ${u.recamaras} Rec | ${u.area}m² | ${u.estado === 'Disponible' ? formatMoney(u.precio) : u.estado}`;
                select.appendChild(option);
            });

            // Populate Plazo Buttons
            const plazosContainer = document.getElementById('plazos-container');
            PLAZOS.forEach(p => {
                const btn = document.createElement('button');
                btn.innerText = `${p} Meses`;
                btn.className = 'px-3 py-1 rounded-full text-xs font-bold border bg-white text-gray-600 border-gray-200 transition-colors';
                btn.onclick = () => setPlazo(p);
                btn.dataset.plazo = p;
                plazosContainer.appendChild(btn);
            });

            // Set Initial Date
            document.getElementById('input-fecha').value = STATE.fecha;
            document.getElementById('input-inicio-mensualidad').value = STATE.fechaInicioMensualidad;
            
            // Initialize Icons
            lucide.createIcons();
            
            // Bind Events
            bindEvents();
        }

        function bindEvents() {
            // Info
            document.getElementById('input-asesor').addEventListener('input', (e) => { STATE.asesor = e.target.value; updatePrintView(); });
            document.getElementById('input-cliente').addEventListener('input', (e) => { STATE.cliente = e.target.value; updatePrintView(); });
            document.getElementById('input-fecha').addEventListener('change', (e) => { STATE.fecha = e.target.value; updatePrintView(); });

            // Unidad
            document.getElementById('select-unidad').addEventListener('change', (e) => {
                const id = e.target.value;
                STATE.unidadSeleccionada = INVENTARIO.find(u => u.id === id);
                STATE.precioBase = STATE.unidadSeleccionada.precio;
                // Reset Descuentos
                STATE.descuentoMonto = 0;
                STATE.descuentoPorcentaje = 0;
                // Show UI
                document.getElementById('dynamic-content').style.display = 'block';
                document.getElementById('sticky-footer').style.display = 'block';
                document.getElementById('btn-print-header').disabled = false;
                
                recalculate();
            });

            // Descuentos
            document.getElementById('input-desc-pct').addEventListener('input', (e) => handleDescuento(e.target.value, 'pct'));
            document.getElementById('input-desc-monto').addEventListener('input', (e) => handleDescuento(e.target.value, 'amt'));

            // Tiempos
            document.getElementById('input-apartado').addEventListener('input', (e) => { STATE.apartado = Number(e.target.value); recalculate(); });
            document.getElementById('input-inicio-mensualidad').addEventListener('change', (e) => { STATE.fechaInicioMensualidad = e.target.value; recalculate(); });
            document.getElementById('input-diferimiento').addEventListener('input', (e) => { STATE.mesesDiferido = Number(e.target.value); recalculate(); });
            document.getElementById('select-diferir-enganche').addEventListener('change', (e) => { STATE.diferirEnganche = Number(e.target.value); recalculate(); });

            // Esquema (Range & Inputs)
            const bindEsquema = (id, field, type) => {
                document.getElementById(id).addEventListener('input', (e) => handleEsquema(e.target.value, field, type));
            };

            bindEsquema('range-enganche', 'enganche', 'pct');
            bindEsquema('input-enganche-pct', 'enganche', 'pct');
            bindEsquema('input-enganche-monto', 'enganche', 'amount');

            bindEsquema('range-financiado', 'financiado', 'pct');
            bindEsquema('input-financiado-pct', 'financiado', 'pct');
            bindEsquema('input-financiado-monto', 'financiado', 'amount');

            bindEsquema('range-contra', 'contra', 'pct');
            bindEsquema('input-contra-pct', 'contra', 'pct');
            bindEsquema('input-contra-monto', 'contra', 'amount');
        }

        // Logic Handlers
        function handleDescuento(val, type) {
            const numVal = Number(val);
            if (type === 'pct') {
                STATE.descuentoPorcentaje = numVal;
                STATE.descuentoMonto = STATE.precioBase * (numVal / 100);
            } else {
                STATE.descuentoMonto = numVal;
                if (STATE.precioBase > 0) STATE.descuentoPorcentaje = (numVal / STATE.precioBase) * 100;
            }
            recalculate();
        }

        function handleEsquema(val, field, type) {
            const numVal = Number(val);
            let nuevoPct = 0;
            
            if (type === 'amount') {
                if (STATE.precioFinal > 0) nuevoPct = (numVal / STATE.precioFinal) * 100;
            } else {
                nuevoPct = numVal;
            }

            if (field === 'enganche') {
                STATE.enganchePorcentaje = nuevoPct;
                STATE.contraEntregaPorcentaje = Math.max(0, 100 - nuevoPct - STATE.financiadoPorcentaje);
            } else if (field === 'financiado') {
                STATE.financiadoPorcentaje = nuevoPct;
                STATE.contraEntregaPorcentaje = Math.max(0, 100 - STATE.enganchePorcentaje - nuevoPct);
            } else if (field === 'contra') {
                STATE.contraEntregaPorcentaje = nuevoPct;
                STATE.financiadoPorcentaje = Math.max(0, 100 - STATE.enganchePorcentaje - nuevoPct);
            }
            recalculate();
        }

        function setPlazo(p) {
            STATE.plazoMeses = p;
            recalculate();
        }

        function recalculate() {
            if (!STATE.unidadSeleccionada) return;

            // 1. Calcular Precio Final
            STATE.precioFinal = STATE.precioBase - STATE.descuentoMonto;

            // 2. Calcular Montos basado en Porcentajes
            STATE.engancheMonto = STATE.precioFinal * (STATE.enganchePorcentaje / 100);
            STATE.financiadoMonto = STATE.precioFinal * (STATE.financiadoPorcentaje / 100);
            STATE.contraEntregaMonto = STATE.precioFinal * (STATE.contraEntregaPorcentaje / 100);

            updateUI();
        }

        function updateUI() {
            // Update Inputs Values (para sincronizar range con input number)
            // Nota: Evitamos actualizar el input que el usuario está escribiendo activamente para no interrumpirlo,
            // pero en esta implementación simple actualizaremos todo para consistencia visual.
            
            // Descuentos
            document.getElementById('input-desc-pct').value = STATE.descuentoPorcentaje.toFixed(2);
            document.getElementById('input-desc-monto').value = STATE.descuentoMonto.toFixed(0); // Redondeo simple para input

            // Esquema Inputs
            document.getElementById('range-enganche').value = STATE.enganchePorcentaje;
            document.getElementById('input-enganche-pct').value = STATE.enganchePorcentaje.toFixed(1);
            document.getElementById('input-enganche-monto').value = Math.round(STATE.engancheMonto);
            document.getElementById('lbl-enganche-pct').innerText = STATE.enganchePorcentaje.toFixed(1);

            document.getElementById('range-financiado').value = STATE.financiadoPorcentaje;
            document.getElementById('input-financiado-pct').value = STATE.financiadoPorcentaje.toFixed(1);
            document.getElementById('input-financiado-monto').value = Math.round(STATE.financiadoMonto);
            document.getElementById('lbl-financiado-pct').innerText = STATE.financiadoPorcentaje.toFixed(1);

            document.getElementById('range-contra').value = STATE.contraEntregaPorcentaje;
            document.getElementById('input-contra-pct').value = STATE.contraEntregaPorcentaje.toFixed(1);
            document.getElementById('input-contra-monto').value = Math.round(STATE.contraEntregaMonto);
            document.getElementById('lbl-contra-pct').innerText = STATE.contraEntregaPorcentaje.toFixed(1);

            // Plazo Buttons Active State
            const btns = document.getElementById('plazos-container').children;
            for (let btn of btns) {
                if (Number(btn.dataset.plazo) === STATE.plazoMeses) {
                    btn.className = 'px-3 py-1 rounded-full text-xs font-bold border bg-yellow-500 text-white border-yellow-600 transition-colors';
                } else {
                    btn.className = 'px-3 py-1 rounded-full text-xs font-bold border bg-white text-gray-600 border-gray-200 transition-colors';
                }
            }

            // Suma Check
            const suma = Number(STATE.enganchePorcentaje) + Number(STATE.financiadoPorcentaje) + Number(STATE.contraEntregaPorcentaje);
            const errorDiv = document.getElementById('error-suma');
            if (suma.toFixed(0) !== "100") {
                errorDiv.style.display = 'block';
                document.getElementById('lbl-suma-total').innerText = suma.toFixed(1);
            } else {
                errorDiv.style.display = 'none';
            }

            // Info Diferimiento
            const msgDiv = document.getElementById('msg-diferimiento');
            if (STATE.mesesDiferido > 0) {
                msgDiv.style.display = 'flex';
                const fechaReal = addMonths(STATE.fechaInicioMensualidad, STATE.mesesDiferido);
                document.getElementById('txt-inicio-real').innerText = formatDate(fechaReal);
                document.getElementById('txt-meses-dif').innerText = STATE.mesesDiferido;
            } else {
                msgDiv.style.display = 'none';
            }

            // Footer Mensualidad
            const mensualidad = STATE.plazoMeses > 0 ? STATE.financiadoMonto / STATE.plazoMeses : 0;
            document.getElementById('txt-mensualidad-footer').innerText = formatMoney(mensualidad);

            updatePrintView();
        }

        function updatePrintView() {
            // Header & Info
            document.getElementById('print-folio').innerText = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            document.getElementById('print-fecha').innerText = formatDate(STATE.fecha);
            document.getElementById('print-cliente').innerText = STATE.cliente || 'Por definir';
            document.getElementById('print-asesor').innerText = STATE.asesor || 'Por asignar';

            // Unit Info
            if (STATE.unidadSeleccionada) {
                document.getElementById('print-unidad').innerText = STATE.unidadSeleccionada.unidad;
                document.getElementById('print-nivel').innerText = STATE.unidadSeleccionada.nivel === 0 ? 'PB' : `Nivel ${STATE.unidadSeleccionada.nivel}`;
                document.getElementById('print-tipologia').innerText = `${STATE.unidadSeleccionada.recamaras} Rec / ${STATE.unidadSeleccionada.area} m²`;
                document.getElementById('print-precio-lista').innerText = formatMoney(STATE.unidadSeleccionada.precio);
            }

            // Financial Summary
            const rowDesc = document.getElementById('row-descuento');
            if (STATE.descuentoMonto > 0) {
                rowDesc.style.display = 'table-row';
                document.getElementById('print-desc-pct').innerText = `${STATE.descuentoPorcentaje.toFixed(2)}%`;
                document.getElementById('print-desc-monto').innerText = `- ${formatMoney(STATE.descuentoMonto)}`;
            } else {
                rowDesc.style.display = 'none';
            }
            document.getElementById('print-precio-final').innerText = formatMoney(STATE.precioFinal);

            // Esquema Table
            document.getElementById('print-apartado').innerText = formatMoney(STATE.apartado);
            
            const engancheNeto = Math.max(0, STATE.engancheMonto - STATE.apartado);
            document.getElementById('print-enganche-pct').innerText = `${STATE.enganchePorcentaje.toFixed(2)}%`;
            document.getElementById('print-enganche-monto').innerText = formatMoney(engancheNeto);
            
            const difTxt = document.getElementById('print-diferir-txt');
            if (STATE.diferirEnganche > 1) {
                difTxt.style.display = 'block';
                difTxt.innerText = `↳ Diferido en ${STATE.diferirEnganche} mensualidades`;
            } else {
                difTxt.style.display = 'none';
            }

            document.getElementById('print-plazo-meses').innerText = STATE.plazoMeses;
            const fechaInicioPagosReal = STATE.mesesDiferido > 0 
                ? addMonths(STATE.fechaInicioMensualidad, STATE.mesesDiferido) 
                : STATE.fechaInicioMensualidad;
            
            let inicioText = `Inicio: ${formatDate(fechaInicioPagosReal)}`;
            if(STATE.mesesDiferido > 0) inicioText += ` (Diferimiento: ${STATE.mesesDiferido} m)`;
            document.getElementById('print-inicio-financiado').innerText = inicioText;

            document.getElementById('print-financiado-pct').innerText = `${STATE.financiadoPorcentaje.toFixed(2)}%`;
            document.getElementById('print-financiado-monto').innerText = formatMoney(STATE.financiadoMonto);

            document.getElementById('print-contra-pct').innerText = `${STATE.contraEntregaPorcentaje.toFixed(2)}%`;
            document.getElementById('print-contra-monto').innerText = formatMoney(STATE.contraEntregaMonto);

            // Mini Tabla Amortización
            generateAmortizacionTable(fechaInicioPagosReal);
        }

        function generateAmortizacionTable(fechaInicioReal) {
            const container = document.getElementById('amortizacion-rows');
            container.innerHTML = '';
            
            const mensualidadFinanciada = STATE.plazoMeses > 0 ? STATE.financiadoMonto / STATE.plazoMeses : 0;
            let count = 0;

            // DIF rows
            for (let i = 1; i <= Math.min(STATE.mesesDiferido, 3); i++) {
                const fechaPago = addMonths(STATE.fechaInicioMensualidad, i);
                addRow(container, 'DIF', formatDate(fechaPago), '---', formatMoney(STATE.financiadoMonto), true);
                count++;
            }

            // Normal rows
            for (let i = 1; i <= STATE.plazoMeses; i++) {
                if (count >= 7) break; 
                const fechaPago = addMonths(fechaInicioReal, i - 1);
                const saldoRestante = STATE.financiadoMonto - (mensualidadFinanciada * i);
                const saldoDisplay = saldoRestante < 1 ? 0 : saldoRestante;
                
                addRow(container, i, formatDate(fechaPago), formatMoney(mensualidadFinanciada), formatMoney(saldoDisplay), false);
                count++;
            }
        }

        function addRow(container, num, fecha, monto, saldo, isDif) {
            const div = document.createElement('div');
            div.className = `grid grid-cols-6 gap-2 text-[9px] text-center font-sans py-0.5 ${isDif ? 'text-blue-600' : 'text-gray-800'}`;
            div.innerHTML = `
                <div>${num}</div>
                <div class="col-span-2">${fecha}</div>
                <div class="col-span-2 text-right">${monto}</div>
                <div class="text-right text-gray-400">${saldo}</div>
            `;
            container.appendChild(div);
        }

        function toggleSection(id) {
            const el = document.getElementById(id);
            if (el.style.display === 'none') el.style.display = 'block';
            else el.style.display = 'none';
        }

        // Initial Run
        init();
    </script>
</body>
</html>
```
